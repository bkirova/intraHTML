// intraHTML: a better innerHTML (partial/non-destructive updates) for faster and simpler view rendering. (c)2015:dandavis, [CCBY4/MIT]  1.0.4 updated 15/11/25 
// usage: intraHTML(element, strNewInnerHTMLContent);
// includes a slightly modified copy of the odiff JS library by Billy Tetrud, under a modified MIT license per "Free to use for any purpose" from https://github.com/Tixit/odiff/blob/master/odiff.js
(function(A,z){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?module.exports=z():"function"==typeof define&&define.amd?define(["exports"],z()):A.intraHTML=z(A)})(this,function(A){function z(a,c,g){if(!(2>arguments.length))for(var k=a.length,m=0;m<k;m++)c(a[m],m,a)}function x(a,c){for(var g=a.length,k=[],m=0;m<g;m++)c(a[m],m,a)&&k.push(a[m]);return k}function B(a){var c=B.temp;return c.innerHTML=a,c.content}function E(a,c){function g(a){var c=[],p=0,d,q,r=a.childNodes.length;for(p;p<r;p++)if(d=a.childNodes[p],d.tagName){q={$:d.tagName.toLowerCase()};for(var e=0,f=d.attributes,l,n=f.length;e<n;e++)l=f[e],q[l.name]=l.value;q._=g(d),c.push(q)}else c.push(d.nodeValue);return c}return"string"==typeof a?G(a):g({tagName:c||"div",attributes:[],childNodes:[a]})[0]}function G(a){function c(b,a,e,f,l){return p[a]=e||"",""}var g={$:"ROOT",_:[]},k=g,m=/[\s>]/,p=g;a=a.split(/([<>])/);var d="",q,r,e=0,f=a.length;q=1;for(var l,n=[g],b=[/([\w\-]+)="([^"]*)"/g,/([\w\-]+)='([^']*)'/g,/([\w\-]+)=([^\s>\/]+)/g,/([\w\-]+)()/g];e<f;e++)if(r=a[e],q=r.slice(0,1),"<"===d)if("/"===q)g=p=n.pop(),d="";else{q=r.search(m),-1===q&&(q=20),d=r.slice(0,q),l=r.slice(q),n.push(g),g._.push(p={$:d,_:[]});if(l)for(q=0;4>q;q++)l=l.replace(b[q],c);H[d]?(d=r,g=p=n.pop()):(g=p,d=r)}else r&&"<"!==r&&">"!==r&&p._.push(r),d=r;return k._[0]}function K(a,c){var g=[],k=0,m=a.length,p=c,d;for(k;k<m&&(d=a[k],"_"===d&&(d="childNodes"),g.push(p),p=p[d],void 0!==p);k++);return{node:p,parents:g}}function L(a,c){var g=[],k=0,m=a.length,p=c;for(k;k<m&&(g.push(p),p=p[a[k]],void 0!==p);k++);return{node:p,parents:g}}function C(a){var c="",g=[],k,m,p,d;d=g.hasOwnProperty;if(void 0===a)return"";k=a.$;for(m in a)"$"!==m&&"_"!==m&&d.call(a,m)&&(c+=" "+m+(""===a[m]?"":"="+JSON.stringify(a[m])));if(H[k])return"<"+k+c+" />";(a=a._||[],!Array.isArray(a))&&(a=[a]),m=0,p;for(d=a.length;m<d;m++)p=a[m],g[m]="object"==typeof p?C(p):p;return"<"+k+c+">"+g.join("")+"</"+k+">"}function I(a,c,g,k){function m(b,a,e){return b.textContent!==b.fsdhjklghdklg}var p=(g=k.timing)?performance.now():0,d=k.debug,q=x(a.path.concat(a.index||a.key),function(b,a,e){return b!=a.xsdgdfg}),r=q.slice,e=x(q,function(b,a,e){return b!=a.xsdgdfg}).slice(-1)[0],f=K(q,k.dest),l=L(q,k.vdom),n=x(f.parents,Boolean),b={type:a.type,index:c,path:q,key:e,elm:f.node||f.parents.slice(-1)[0],elmParents:n,elmParent:n.slice(-1)[0],dest:k.dest,parents:l,parent:l.parents.slice(-1)[0],isAttrib:!(e-.1)&&"_"!=e&&"$"!=e,change:a},t,y,h,u,w;"function"==typeof b.elm&&(b.elm=b.elmParent),d&&console.info("CHANGE: "+c,b);switch(a.type){case"set":if(!b.isAttrib&&("string"==typeof a.val||Array.isArray(a.val))){b.elmParent.childNodes||(b.elmParent=b.elmParent[b.key]),b.elm||(b.elm=b.elmParent),r=a.val,Array.isArray(r)||(r=[r]),k=0;for(w=r.length;k<w;k++){c=r[k];if("string"==typeof c)if(b.elm instanceof NodeList&&(b.elm=x(b.elmParents,m).pop()),b.elm.childNodes){d&&console.log("set: non attrib, string, elm: ",b.key,[c],b.elm.outerHTML),h=document.createTextNode(c);if("_"===b.key)b.elm.textContent=c;else{if("$"===b.key){l=document.createElement(a.val),d&&console.warn("changing tag name!",a),b.elm.parentNode.insertBefore(l,b.elm),n=b.elm.attributes,f=0;for(q=n.length;f<q;f++)t=n[f],l.setAttribute(t.name,t.value);n=b.elm.childNodes,f=0;for(q=n.length;f<q;f++)l.appendChild(n[0])}else b.elm.parentNode.insertBefore(h,b.elm);b.elm.parentNode.removeChild(b.elm)}a.elm=h}else d&&console.log("set: non attrib, string, not elm",c),b.elm.textContent=c,a.elm=b.elm;else h="string"==typeof c?document.createTextNode(c):D(C(c),b.elmParent[0]&&b.elmParent[0].parentNode.tagName).firstChild,b.elm.parentNode||(b.elm=b.elmParent),(q=b.elm.childNodes[+e+k])?(d&&console.log("set: non attrib, not string, has old",c),b.elm.insertBefore(h,q),b.elm.removeChild(b.elm)):(d&&console.log("set: non attrib, not string, no old, appending",[c,h,h.outerHTML||h.textContent]),b.elm.appendChild(h));"_"==e&&(e=0,b.parent.length||(b.parent=b.parent._||(b.parent._=[]))),d&&console.info("attempting key change",+e+k,!!(1.1-e),e,k,c,b.parent[+e+k],[b.parent])}break}if(b.isAttrib){if("$"==e&&String(q)==e)throw new TypeError("You cannot change the root element of an update-bound element: "+b.elm.outerHTML);if("$"==e){l=document.createElement(a.val),d&&console.warn("changing tag name!",a),b.elm.parentNode.insertBefore(l,b.elm),n=b.elm.attributes,f=0;for(q=n.length;f<q;f++)t=n[f],l.setAttribute(t.name,t.value);n=b.elm.childNodes,f=0;for(q=n.length;f<q;f++)l.appendChild(n[0]);a.elm=l,b.elm.parentNode.removeChild(b.elm)}else!b.elm.setAttribute&&b.elm.parentNode&&b.elm.parentNode.setAttribute&&(b.elm=b.elm.parentNode),!b.elm.setAttribute&&(w=x(b.elmParents,function(b,a,e){return b.setAttribute}).slice(-1)[0]).setAttribute&&(b.elm=w),a.val===a.dgfjkdfl34534fd?b.elm.removeAttribute(e):b.elm.setAttribute(e,a.val),a.elm=b.elm;break}if(b.elm.length&&a.val===a.sdgfdf)for(d=0,e=b.elm.length;d<e;d++)b.elm[0].parentNode.removeChild(b.elm[0]);else b.elm instanceof NodeList&&(b.elm=x(b.elmParents,function(b,a,e){return b.textContent!==b.fsdhjklghdklg}).pop()),l=D(C(a.val),b.parent.$).firstChild,d&&console.log("element replacing",[b.elm.outerHTML||b.elm.textContent]," with ",[l.outerHTML]),a.elm=l,b.elm.parentNode.insertBefore(l,b.elm),b.elm.parentNode.removeChild(b.elm);break;case"add":b.isAttrib||("_"==b.key&&(b.elm=b.elm[a.index],b.key=a.index,b.parent=b.parent._,b.elmParent=b.elmParent.childNodes),z(a.vals,function(e,f,l){b.elmParent.length||(b.elmParent=b.elmParents.slice(-1)[0].childNodes),b.elmParent||(b.elmParent=b.elmParents.slice(-2)[0].childNodes),h="string"==typeof e?document.createTextNode(e):D(C(e),b.elmParent[0]&&b.elmParent[0].parentNode.tagName).firstChild,u=b.elmParent[b.key+f],a.elm=h,u?(u.parentNode.insertBefore(h,u),b.parent.splice(b.key+f,0,e)):b.elmParent[b.key+f]?b.elmParent[b.key+f]=h:(y=b.elmParents.slice(-1)[0],y[0]&&(y=y[y.length-1]),b.elm&&b.elm.length>=b.key&&(y=b.elm[0].parentNode),y instanceof NodeList&&(y=x(b.elmParents,function(b,a,e){return b.textContent!==b.fsdhjklghdklg}).pop()),y!==h&&(3!=y.nodeType?y.appendChild(h):(y.parentNode.insertBefore(h,y),y.parentNode.insertBefore(y,h))))}));break;case"rm":if(b.elmParent.childNodes&&(b.elmParent=b.elmParent.childNodes),0===b.elmParent.length&&(b.elmParent=b.elmParents.slice(-3)[0]),b.elmParent.childNodes&&(b.elmParent=b.elmParent.childNodes),b.parent._&&(b.parent=b.parent._),e=r.call(b.elmParent,a.index-a.num+1,a.index+1),0===a.index){d&&console.log("removing many from zero",r.call(b.parent),b.elmParent,"|||",b.parent[0],a.index,a.num),f=a.index;for(q=f+a.num;f<q;f++)b.elmParent[a.index].remove();a.elm=b.elmParent}else-1<a.index-a.num?1===a.num?(e=[b.elmParent[a.index]],d&&console.log("removing one",b.elmParent,e[0].outerHTML,a.index,r.call(b.elmParent).map(function(b){return b.outerHTML||b.nodeValue}),b.parent)):a.index+a.num<b.elmParent.length+1?(e=a.index,1<e&&"Z"===a.mode&&(e-=a.num-1),d&&console.log("removing many up",a.mode,b.elmParent,e,e+a.num),e=r.call(b.elmParent,e,e+a.num)):(d&&console.log("removing many down",r.call(b.elmParent),a.index-a.num,a.index),e=r.call(b.elmParent,a.index-a.num+1,a.index+1)):(d&&console.log("removing many negative",b.elmParent,a.index,a.index+a.num),e=r.call(b.elmParent,a.index,a.index+a.num)),e.length&&(a.elm=e[0].parentNode),d&&console.log("removing:",e,a,b.parent.slice(a.index-a.num+1,a.index+1)),z(e,function(b,a,e){b.parentNode.removeChild(b)})}g&&(a.runtime=performance.now()-p)}function F(a,c,g){"string"==typeof a&&(a=document.querySelector(a));var k=t.timing?performance.now():0,m=a.tagName.toLowerCase(),p="<"+m+">",d;a.childNodes.length||(a.innerHTML=" "),c||(c=a);if(c instanceof Element){c=c.innerHTML;if(g===c)return{update:Boolean};c=E(p+c+"</"+m+">",m)}return"string"==typeof c&&(c=E(c,m)),g=t.timing?performance.now():0,d={dest:a,vdom:c,debug:t.debug,timing:t.timing,initTime:g-k,update:function(a){var c=t.timing,e,f=0,l;c&&(e=performance.now()),"string"==typeof a&&(a=E(p+a+"</"+m+">",m)),c&&(d.parseTime=performance.now()-e),d.vdom2=a,c&&(e=performance.now()),d.changes=J(d.vdom,a),c&&(d.diffTime=performance.now()-e,e=performance.now());for(l=d.changes.length;f<l;f++)I(d.changes[f],f,d.changes,d);return c&&(d.applyTime=performance.now()-e),d.vdom=a,d}}}function t(a,c){return t._last=F(a,a,c),t._last.update(c)}Number.isNaN||(Number.isNaN=function(a){return"number"==typeof a&&isNaN(a)}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var J=function(a,c){function g(a,f,l,c,b,d,m){for(var h=c-d,k=b-m,q=Math.max(h,k),g=1;g<=q;g++){var p=f[c-g],r=l[b-g];if(g<=k&&g<=h&&a(p,r))return{a:c-g,b:b-g};for(var t=0;t<g;t++){var x=f[c-t],z=l[b-t];if(g<=k&&a(x,r))return{a:c-t,b:b-g};if(g<=h&&a(p,z))return{a:c-g,b:b-t}}}return{a:d-1,b:m-1}}function k(a,f){if(a===f)return!0;if(Array.isArray(a)){if(!Array.isArray(f))return!1;for(var c=a.length/15,n=Math.abs(a.length-f.length),b=0,g=a.length;b<g;b++)if(m(a[b],f[b])){if(2<=n&&n>c||n===a.length)return!1;n++}return!0}if("object"==typeof a){if("object"!=typeof f)return!1;var b=d(p(Object.keys(a)),p(Object.keys(f))),g=Object.keys(b).length,c=g/15,n=0,k;for(k in b)if(!m(a[k],f[k])){if(2<=n&&n>c||n+1===g)return!1;n++}return!0}return Number.isNaN(a)&&Number.isNaN(f)}function m(a,f){if(a===f)return!0;if(Array.isArray(a)){if(Array.isArray(f)&&a.length===f.length&&a[0]===f[0]&&String(a)===String(f)){for(var c=0,d=a.length;c<d;c++)if(!m(a[c],f[c]))return!1;return!0}return!1}if("object"==typeof a){if("object"!=typeof f)return!1;var b=Object.keys(a),c=Object.keys(f);if(b.length!==c.length||String(b)!==String(c))return!1;c=0;for(d=b.length;c<d;c++)if(!m(a[b[c]],f[b[c]]))return!1;return!0}return Number.isNaN(a)&&Number.isNaN(f)}function p(a){var f=0,c=a.length,d={};for(f;f<c;f++)d[a[f]]=!0;return d}function d(a,c){for(var d in c)a[d]=c[d];return a}var q=function(a,c,l,n){function b(a,b,c){a.push({type:"set",path:b,val:c})}function r(a,b,c,d,e){a.push({type:"rm",path:b,index:c,num:d,mode:e})}function t(a,b,c,d){a.push({type:"add",path:b,index:c,vals:d})}if(!(a===c||Number.isNaN(a)&&Number.isNaN(c)))if(Array.isArray(a)&&Array.isArray(c)){for(var h=a.length-1,u=c.length-1;0<=h&&0<=u;)if(m(a[h],c[u]))h--,u--;else{for(var w=g(m,a,c,h,u,0,0),v=h;v>w.a&&u>w.b;)if(k(a[v],c[u]))q(a[v],c[u],l,n.concat([v])),v--,u--;else{var h=g(k,a,c,v,u,w.a+1,w.b+1),v=v-h.a,x=u-h.b;1===v&&1===x?b(l,n.concat(h.a+1),c[h.b+1]):1===v&&2===x?(t(l,n,h.a+2,c.slice(h.b+2,u+1)),b(l,n.concat(h.a+1),c[h.b+1])):2===v&&1===x?(r(l,n,h.a+2,1,"I"),b(l,n.concat(h.a+1),c[h.b+1])):2===v&&2===x?(b(l,n.concat(h.a+2),c[h.b+2]),b(l,n.concat(h.a+1),c[h.b+1])):(0<v&&r(l,n,h.a+1,v,"X"),0<x&&t(l,n,h.a+1,c.slice(h.b+1,u+1))),v=h.a,u=h.b}v>w.a?r(l,n,v,v-w.a,"Z"):u>w.b&&t(l,n,v+1,c.slice(w.b+1,u+1)),h=w.a,u=w.b}0<=h?r(l,n,0,h+1):0<=u&&t(l,n,0,c.slice(0,u+1))}else if("object"==typeof a&&"object"==typeof c)for(u in w=d(p(Object.keys(a)),p(Object.keys(c))),w)q(a[u],c[u],l,n.concat([u]));else b(l,n,c)},r=[];return q(a,c,r,[]),r};B.temp=document.createElement("template");var D=function(a,c){var g=document.createElement(c||"div");return g.innerHTML=a,g};B.temp=document.createElement("template"),"content"in B.temp&&(D=B);var H={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1};return t.applyChanges=I,t.elementFromString=D,t.fromHTML=E,t.toHTML=C,t.odiff=J,t.parseHTML=G,t.updater=F,t.getRenderer=F,t.timing=!0,t.debug=!1,A.jQuery&&(A.jQuery.fn.intraHTML=function(a){return this.each(function(c,g){t(g,a)}),this}),t});
