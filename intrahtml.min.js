// intraHTML: a better innerHTML (partial/non-destructive updates) for faster and simpler view rendering. (c)2015:dandavis, [CCBY4/MIT]  1.0.3 updated 15/11/25 
// usage: intraHTML(element, strNewInnerHTMLContent);
// includes a slightly modified copy of the odiff JS library by Billy Tetrud, under a modified MIT license per "Free to use for any purpose" from https://github.com/Tixit/odiff/blob/master/odiff.js
(function(B,x){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?module.exports=x():"function"==typeof define&&define.amd?define(["exports"],x()):B.intraHTML=x(B)})(this,function(B){function x(b){var c=x.temp;return c.innerHTML=b,c.content}function F(b,c,k){if(!(2>arguments.length))for(var g=b.length,l=0;l<g;l++)c(b[l],l,b)}function w(b,c){for(var k=b.length,g=[],l=0;l<k;l++)c(b[l],l,b)&&g.push(b[l]);return g}function G(b,c){function k(b){var c=[],e=0,d,p,f=b.childNodes.length;for(e;e<f;e++)if(d=b.childNodes[e],d.tagName){p={$:d.tagName.toLowerCase()};for(var h=0,a=d.attributes,q,r=a.length;h<r;h++)q=a[h],p[q.name]=q.value;p._=k(d),c.push(p)}else c.push(d.nodeValue);return c}return"string"==typeof b?k(z(b,c))[0]:k({tagName:c||"div",attributes:[],childNodes:[b]})[0]}function J(b,c){var k=[],g=0,l=b.length,e=c,d;for(g;g<l&&(d=b[g],"_"===d&&(d="childNodes"),k.push(e),e=e[d],void 0!==e);g++);return{node:e,parents:k}}function K(b,c){var k=[],g=0,l=b.length,e=c;for(g;g<l&&(k.push(e),e=e[b[g]],void 0!==e);g++);return{node:e,parents:k}}function C(b){var c="",k,g=[],l=g.hasOwnProperty;if(b===k)return"";for(var e in b)l.call(b,e)&&"$"!==e&&"_"!==e&&(k=" "+e,""!==b[e]&&(k+="="+JSON.stringify(b[e])),c+=k);if(L[b.$])return"<"+b.$+c+" />";(k=b._||[],!Array.isArray(k))&&(k=[k]);for(var l=g.length=0,d=k.length;l<d;l++)e=k[l]||"",g[l]="object"==typeof e?C(e):""+e;return"<"+b.$+c+">"+g.join("")+"</"+b.$+">"}function H(b,c,k){k=performance.now();var g=this.debug,l=w(b.path.concat(b.index||b.key),function(a,b,h){return a!=b.xsdgdfg}),e=l.slice,d=w(l,function(a,b,h){return a!=b.xsdgdfg}).slice(-1)[0],p=J(l,this.dest),f=K(l,this.vdom),h=w(p.parents,Boolean),a={type:b.type,index:c,path:l,key:d,elm:p.node||p.parents.slice(-1)[0],elmParents:h,elmParent:h.slice(-1)[0],dest:this.dest,parents:f,parent:f.parents.slice(-1)[0],velm:f.node,vdom:this.vdom,isElm:"string"!=typeof f.node,isAttrib:!(d-.1)&&"_"!=d&&"$"!=d,change:b};"function"==typeof a.elm&&(a.elm=a.elmParent),g&&console.info("CHANGE: "+c,a);switch(b.type){case"set":if(!a.isAttrib&&("string"==typeof b.val||Array.isArray(b.val))){a.elmParent.childNodes||(a.elmParent=a.elmParent[a.key]),a.elm||(a.elm=a.elmParent),e=b.val,Array.isArray(e)||(e=[e]);for(var q=0,l=e.length;q<l;q++){c=e[q];if("string"==typeof c)if(a.elm instanceof NodeList&&(a.elm=w(a.elmParents,function(a,b,h){return a.textContent!==a.fsdhjklghdklg}).pop()),a.elm.childNodes){g&&console.log("set: non attrib, string, elm: ",a.key,[c],a.elm.outerHTML),p=document.createTextNode(c);if("_"===a.key)a.elm.textContent=c;else{if("$"===a.key){f=document.createElement(b.val),g&&console.warn("changing tag name!",b),a.elm.parentNode.insertBefore(f,a.elm);for(var r=a.elm.attributes,h=0,v=r.length;h<v;h++){var D=r[h];f.setAttribute(D.name,D.value)}r=a.elm.childNodes,h=0;for(v=r.length;h<v;h++)f.appendChild(r[0])}else a.elm.parentNode.insertBefore(p,a.elm);a.elm.parentNode.removeChild(a.elm)}b.elm=p}else g&&console.log("set: non attrib, string, not elm",c),a.elm.textContent=c,b.elm=a.elm;else p="string"==typeof c?document.createTextNode(c):z(C(c),a.elmParent[0]&&a.elmParent[0].parentNode.tagName).firstChild,a.elm.parentNode||(a.elm=a.elmParent),(f=a.elm.childNodes[+d+q])?(g&&console.log("set: non attrib, not string, has old",c),a.elm.insertBefore(p,f),a.elm.removeChild(a.elm)):(g&&console.log("set: non attrib, not string, no old, appending",[c,p,p.outerHTML||p.textContent]),a.elm.appendChild(p));"_"==d&&(d=0,a.parent.length||(a.parent=a.parent._||(a.parent._=[]))),g&&console.info("attempting key change",+d+q,!!(1.1-d),d,q,c,a.parent[+d+q],[a.parent])}break}if(a.isAttrib){if("$"==d&&String(l)==d)throw new TypeError("You cannot change the root element of an update-bound element: "+a.elm.outerHTML);if("$"==d){f=document.createElement(b.val),g&&console.warn("changing tag name!",b),a.elm.parentNode.insertBefore(f,a.elm),r=a.elm.attributes,h=0;for(v=r.length;h<v;h++)D=r[h],f.setAttribute(D.name,D.value);r=a.elm.childNodes,h=0;for(v=r.length;h<v;h++)f.appendChild(r[0]);b.elm=f,a.elm.parentNode.removeChild(a.elm)}else!a.elm.setAttribute&&a.elm.parentNode&&a.elm.parentNode.setAttribute&&(a.elm=a.elm.parentNode),!a.elm.setAttribute&&(q=w(a.elmParents,function(a,b,h){return a.setAttribute}).slice(-1)[0]).setAttribute&&(a.elm=q),b.val===b.dgfjkdfl34534fd?a.elm.removeAttribute(d):a.elm.setAttribute(d,b.val),b.elm=a.elm;break}if(a.elm.length&&b.val===b.sdgfdf)for(g=0,d=a.elm.length;g<d;g++)a.elm[0].parentNode.removeChild(a.elm[0]);else a.elm instanceof NodeList&&(a.elm=w(a.elmParents,function(a,b,h){return a.textContent!==a.fsdhjklghdklg}).pop()),f=z(C(b.val),a.parent.$).firstChild,g&&console.log("element replacing",[a.elm.outerHTML||a.elm.textContent]," with ",[f.outerHTML]),b.elm=f,a.elm.parentNode.insertBefore(f,a.elm),a.elm.parentNode.removeChild(a.elm);break;case"add":a.isAttrib||("_"==a.key&&(a.elm=a.elm[b.index],a.key=b.index,a.parent=a.parent._,a.elmParent=a.elmParent.childNodes),F(b.vals,function(h,d,q){a.elmParent.length||(a.elmParent=a.elmParents.slice(-1)[0].childNodes),a.elmParent||(a.elmParent=a.elmParents.slice(-2)[0].childNodes),q="string"==typeof h?document.createTextNode(h):z(C(h),a.elmParent[0]&&a.elmParent[0].parentNode.tagName).firstChild;var c=a.elmParent[a.key+d];b.elm=q,c?(c.parentNode.insertBefore(q,c),a.parent.splice(a.key+d,0,h)):a.elmParent[a.key+d]?a.elmParent[a.key+d]=q:(h=a.elmParents.slice(-1)[0],h[0]&&(h=h[h.length-1]),a.elm&&a.elm.length>=a.key&&(h=a.elm[0].parentNode),h instanceof NodeList&&(h=w(a.elmParents,function(a,b,h){return a.textContent!==a.fsdhjklghdklg}).pop()),h!==q&&(3!=h.nodeType?h.appendChild(q):(h.parentNode.insertBefore(q,h),h.parentNode.insertBefore(h,q))))}));break;case"rm":if(a.elmParent.childNodes&&(a.elmParent=a.elmParent.childNodes),0===a.elmParent.length&&(a.elmParent=a.elmParents.slice(-3)[0]),a.elmParent.childNodes&&(a.elmParent=a.elmParent.childNodes),a.parent._&&(a.parent=a.parent._),d=e.call(a.elmParent,b.index-b.num+1,b.index+1),0===b.index){g&&console.log("removing many from zero",e.call(a.parent),a.elmParent,"|||",a.parent[0],b.index,b.num),h=b.index;for(v=h+b.num;h<v;h++)a.elmParent[b.index].remove();b.elm=a.elmParent}else-1<b.index-b.num?1===b.num?(d=[a.elmParent[b.index]],g&&console.log("removing one",a.elmParent,d[0].outerHTML,b.index,e.call(a.elmParent).map(function(a){return a.outerHTML||a.nodeValue}),a.parent)):b.index+b.num<a.elmParent.length+1?(d=b.index,1<d&&"Z"===b.mode&&(d-=b.num-1),g&&console.log("removing many up",b.mode,a.elmParent,d,d+b.num),d=e.call(a.elmParent,d,d+b.num)):(g&&console.log("removing many down",e.call(a.elmParent),b.index-b.num,b.index),d=e.call(a.elmParent,b.index-b.num+1,b.index+1)):(g&&console.log("removing many negative",a.elmParent,b.index,b.index+b.num),d=e.call(a.elmParent,b.index,b.index+b.num)),d.length&&(b.elm=d[0].parentNode),g&&console.log("removing:",d,b,a.parent.slice(b.index-b.num+1,b.index+1)),F(d,function(a,b,h){a.parentNode.removeChild(a)})}b.runtime=performance.now()-k}function E(b,c,k){var g=performance.now();"string"==typeof b&&(b=document.querySelector(b));var l=b.tagName.toLowerCase(),e=b.outerHTML,d=e.slice(0,e.indexOf(">"))+">",p=e.slice(d.length,e.lastIndexOf("<")-1);if(k&&k.trim()===p.trim())return{update:Boolean};p||(p=b.innerHTML=" "),c||(c=e);if(c instanceof Element||"string"==typeof c)c=G(c,l);k=performance.now();var f={dest:b,vdom:c,debug:u.debug,initTime:k-g,update:function(b){var a=performance.now();return"string"==typeof b&&(b=G(d+b+"</"+l+">",l)),f.parseTime=performance.now()-a,f.vdom2=b,a=performance.now(),f.changes=I(f.vdom,b),f.diffTime=performance.now()-a,a=performance.now(),F(f.changes,H.bind(f)),f.applyTime=performance.now()-a,f.vdom=b,f}};return E.last=f,f}function u(b,c){return u._last=E(b,b,c),u._last.update(c)}Number.isNaN||(Number.isNaN=function(b){return"number"==typeof b&&isNaN(b)}),Array.isArray||(Array.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)});var I=function(b,c){function k(b,a,q,d,c,e,g){for(var l=d-e,k=c-g,f=Math.max(l,k),m=1;m<=f;m++){var p=a[d-m],u=q[c-m];if(m<=k&&m<=l&&b(p,u))return{a:d-m,b:c-m};for(var A=0;A<m;A++){var x=a[d-A],w=q[c-A];if(m<=k&&b(x,u))return{a:d-A,b:c-m};if(m<=l&&b(p,w))return{a:d-m,b:c-A}}}return{a:e-1,b:g-1}}function g(b,a){if(b===a)return!0;if(Array.isArray(b)){if(!Array.isArray(a))return!1;for(var c=b.length/15,r=Math.abs(b.length-a.length),g=0,k=b.length;g<k;g++)if(l(b[g],a[g])){if(2<=r&&r>c||r===b.length)return!1;r++}return!0}if("object"==typeof b){if("object"!=typeof a)return!1;var g=d(e(Object.keys(b)),e(Object.keys(a))),k=Object.keys(g).length,c=k/15,r=0,f;for(f in g)if(!l(b[f],a[f])){if(2<=r&&r>c||r+1===k)return!1;r++}return!0}return Number.isNaN(b)&&Number.isNaN(a)}function l(b,a){if(b===a)return!0;if(Array.isArray(b)){if(Array.isArray(a)&&b.length===a.length&&b[0]===a[0]&&String(b)===String(a)){for(var c=0,d=b.length;c<d;c++)if(!l(b[c],a[c]))return!1;return!0}return!1}if("object"==typeof b){if("object"!=typeof a)return!1;var e=Object.keys(b),c=Object.keys(a);if(e.length!==c.length||String(e)!==String(c))return!1;c=0;for(d=e.length;c<d;c++)if(!l(b[e[c]],a[e[c]]))return!1;return!0}return Number.isNaN(b)&&Number.isNaN(a)}function e(b){var a=0,c=b.length,d={};for(a;a<c;a++)d[b[a]]=!0;return d}function d(b,a){for(var c in a)b[c]=a[c];return b}var p=function(b,a,c,f){function v(a,b,c){a.push({type:"set",path:b,val:c})}function u(a,b,c,d,e){a.push({type:"rm",path:b,index:c,num:d,mode:e})}function x(a,b,c,d){a.push({type:"add",path:b,index:c,vals:d})}if(!(b===a||Number.isNaN(b)&&Number.isNaN(a)))if(Array.isArray(b)&&Array.isArray(a)){for(var n=b.length-1,t=a.length-1;0<=n&&0<=t;)if(l(b[n],a[t]))n--,t--;else{for(var y=k(l,b,a,n,t,0,0),m=n;m>y.a&&t>y.b;)if(g(b[m],a[t]))p(b[m],a[t],c,f.concat([m])),m--,t--;else{var n=k(g,b,a,m,t,y.a+1,y.b+1),m=m-n.a,w=t-n.b;1===m&&1===w?v(c,f.concat(n.a+1),a[n.b+1]):1===m&&2===w?(x(c,f,n.a+2,a.slice(n.b+2,t+1)),v(c,f.concat(n.a+1),a[n.b+1])):2===m&&1===w?(u(c,f,n.a+2,1,"I"),v(c,f.concat(n.a+1),a[n.b+1])):2===m&&2===w?(v(c,f.concat(n.a+2),a[n.b+2]),v(c,f.concat(n.a+1),a[n.b+1])):(0<m&&u(c,f,n.a+1,m,"X"),0<w&&x(c,f,n.a+1,a.slice(n.b+1,t+1))),m=n.a,t=n.b}m>y.a?u(c,f,m,m-y.a,"Z"):t>y.b&&x(c,f,m+1,a.slice(y.b+1,t+1)),n=y.a,t=y.b}0<=n?u(c,f,0,n+1):0<=t&&x(c,f,0,a.slice(0,t+1))}else if("object"==typeof b&&"object"==typeof a)for(t in y=d(e(Object.keys(b)),e(Object.keys(a))),y)p(b[t],a[t],c,f.concat([t]));else v(c,f,a)},f=[];return p(b,c,f,[]),f};x.temp=document.createElement("template");var z=function(b,c){var k=document.createElement(c||"div");return k.innerHTML=b,k};"content"in document.createElement("template")&&(z=x);var L={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1};return u.odiff=I,u.updater=E,u.applyChanges=H,u.toHTML=C,u.fromHTML=G,u.elementFromString=z,u.getRenderer=E,B.jQuery&&(B.jQuery.fn.intraHTML=function(b){return this.each(function(c,k){u(k,b)}),this}),u})