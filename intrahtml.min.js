// intraHTML: a better innerHTML (partial/non-destructive updates) for faster and simpler view rendering. (c)2015:dandavis, [CCBY4/MIT]  1.0.4 updated 15/11/25 
// usage: intraHTML(element, strNewInnerHTMLContent);
// includes a slightly modified copy of the odiff JS library by Billy Tetrud, under a modified MIT license per "Free to use for any purpose" from https://github.com/Tixit/odiff/blob/master/odiff.js
(function(B,y){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?module.exports=y():"function"==typeof define&&define.amd?define(["exports"],y()):B.intraHTML=y(B)})(this,function(B){function y(b,d,l){if(!(2>arguments.length))for(var r=b.length,k=0;k<r;k++)d(b[k],k,b)}function A(b,d){for(var l=b.length,r=[],k=0;k<l;k++)d(b[k],k,b)&&r.push(b[k]);return r}function C(b){var d=C.temp;return d.innerHTML=b,d.content}function F(b,d){function l(b){var d=[],h=0,m,p,e=b.childNodes.length;for(h;h<e;h++)if(m=b.childNodes[h],m.tagName){p={$:m.tagName.toLowerCase()};for(var v=0,c=m.attributes,f,a=c.length;v<a;v++)f=c[v],p[f.name]=f.value;p._=l(m),d.push(p)}else d.push(m.nodeValue);return d}return"string"==typeof b?H(b):l({tagName:d||"div",attributes:[],childNodes:[b]})[0]}function H(b){var d={$:"ROOT",_:[]},l=d,r=/^['"]/,k=/['"]$/,h=/\s+/,m=/^[\w\-]+/,p=/^"[^"]*"/,e=/^'[^']*'/,v=/[\s>]/,c={};b=b.split(/([<>])/);for(var f="",a,w,z=0,x=b.length,g=1,q,t,n=[d];z<x;z++)if(w=b[z],a=w.slice(0,1),"<"===f&&"/"===a)d=c=n.pop(),f="";else{if("<"===f){c=w.split(v)[0],f=w.slice(c.length+1).trim().split("="),a=f[0].trim(),n.push(d),d._.push(c={$:c,_:[]}),g=1;for(d=f.length;g<d;g++){q=f[g].trim();switch(q.slice(0,1)){case"'":t=q.match(e)[0];break;case'"':t=q.match(p)[0];break;default:t=q.match(m)[0]}v.test(a)&&(a=a.split(h),c[a[0]]="",a=a[1]),c[a]=t.trim().replace(r,"").replace(k,""),a=q.slice(t.length+1)}d=c}else w&&"<"!==w&&">"!==w&&c._&&c._.push(w);f=w}return l._[0]}function K(b,d){var l=[],r=0,k=b.length,h=d,m;for(r;r<k&&(m=b[r],"_"===m&&(m="childNodes"),l.push(h),h=h[m],void 0!==h);r++);return{node:h,parents:l}}function L(b,d){var l=[],r=0,k=b.length,h=d;for(r;r<k&&(l.push(h),h=h[b[r]],void 0!==h);r++);return{node:h,parents:l}}function D(b){var d="",l=[],r,k,h,m;m=l.hasOwnProperty;if(void 0===b)return"";r=b.$;for(k in b)"$"!==k&&"_"!==k&&m.call(b,k)&&(d+=" "+k+(""===b[k]?"":"="+JSON.stringify(b[k])));if(M[r])return"<"+r+d+" />";(b=b._||[],!Array.isArray(b))&&(b=[b]),k=0,h;for(m=b.length;k<m;k++)h=b[k],l[k]="object"==typeof h?D(h):h;return"<"+r+d+">"+l.join("")+"</"+r+">"}function I(b,d,l){function r(a,b,c){return a.textContent!==a.fsdhjklghdklg}var k=(l=this.timing)?performance.now():0,h=this.debug,m=A(b.path.concat(b.index||b.key),function(a,b,c){return a!=b.xsdgdfg}),p=m.slice,e=A(m,function(a,b,c){return a!=b.xsdgdfg}).slice(-1)[0],v=K(m,this.dest),c=L(m,this.vdom),f=A(v.parents,Boolean),a={type:b.type,index:d,path:m,key:e,elm:v.node||v.parents.slice(-1)[0],elmParents:f,elmParent:f.slice(-1)[0],dest:this.dest,parents:c,parent:c.parents.slice(-1)[0],isAttrib:!(e-.1)&&"_"!=e&&"$"!=e,change:b},w,z,x,g,q,t;"function"==typeof a.elm&&(a.elm=a.elmParent),h&&console.info("CHANGE: "+d,a);switch(b.type){case"set":if(!a.isAttrib&&("string"==typeof b.val||Array.isArray(b.val))){a.elmParent.childNodes||(a.elmParent=a.elmParent[a.key]),a.elm||(a.elm=a.elmParent),p=b.val,Array.isArray(p)||(p=[p]),t=0;for(m=p.length;t<m;t++){d=p[t];if("string"==typeof d)if(a.elm instanceof NodeList&&(a.elm=A(a.elmParents,r).pop()),a.elm.childNodes){h&&console.log("set: non attrib, string, elm: ",a.key,[d],a.elm.outerHTML),g=document.createTextNode(d);if("_"===a.key)a.elm.textContent=d;else{if("$"===a.key){f=document.createElement(b.val),h&&console.warn("changing tag name!",b),a.elm.parentNode.insertBefore(f,a.elm),w=a.elm.attributes,c=0;for(v=w.length;c<v;c++)z=w[c],f.setAttribute(z.name,z.value);w=a.elm.childNodes,c=0;for(v=w.length;c<v;c++)f.appendChild(w[0])}else a.elm.parentNode.insertBefore(g,a.elm);a.elm.parentNode.removeChild(a.elm)}b.elm=g}else h&&console.log("set: non attrib, string, not elm",d),a.elm.textContent=d,b.elm=a.elm;else g="string"==typeof d?document.createTextNode(d):E(D(d),a.elmParent[0]&&a.elmParent[0].parentNode.tagName).firstChild,a.elm.parentNode||(a.elm=a.elmParent),(v=a.elm.childNodes[+e+t])?(h&&console.log("set: non attrib, not string, has old",d),a.elm.insertBefore(g,v),a.elm.removeChild(a.elm)):(h&&console.log("set: non attrib, not string, no old, appending",[d,g,g.outerHTML||g.textContent]),a.elm.appendChild(g));"_"==e&&(e=0,a.parent.length||(a.parent=a.parent._||(a.parent._=[]))),h&&console.info("attempting key change",+e+t,!!(1.1-e),e,t,d,a.parent[+e+t],[a.parent])}break}if(a.isAttrib){if("$"==e&&String(m)==e)throw new TypeError("You cannot change the root element of an update-bound element: "+a.elm.outerHTML);if("$"==e){f=document.createElement(b.val),h&&console.warn("changing tag name!",b),a.elm.parentNode.insertBefore(f,a.elm),w=a.elm.attributes,c=0;for(v=w.length;c<v;c++)z=w[c],f.setAttribute(z.name,z.value);w=a.elm.childNodes,c=0;for(v=w.length;c<v;c++)f.appendChild(w[0]);b.elm=f,a.elm.parentNode.removeChild(a.elm)}else!a.elm.setAttribute&&a.elm.parentNode&&a.elm.parentNode.setAttribute&&(a.elm=a.elm.parentNode),!a.elm.setAttribute&&(t=A(a.elmParents,function(a,b,c){return a.setAttribute}).slice(-1)[0]).setAttribute&&(a.elm=t),b.val===b.dgfjkdfl34534fd?a.elm.removeAttribute(e):a.elm.setAttribute(e,b.val),b.elm=a.elm;break}if(a.elm.length&&b.val===b.sdgfdf)for(h=0,e=a.elm.length;h<e;h++)a.elm[0].parentNode.removeChild(a.elm[0]);else a.elm instanceof NodeList&&(a.elm=A(a.elmParents,function(a,b,c){return a.textContent!==a.fsdhjklghdklg}).pop()),f=E(D(b.val),a.parent.$).firstChild,h&&console.log("element replacing",[a.elm.outerHTML||a.elm.textContent]," with ",[f.outerHTML]),b.elm=f,a.elm.parentNode.insertBefore(f,a.elm),a.elm.parentNode.removeChild(a.elm);break;case"add":a.isAttrib||("_"==a.key&&(a.elm=a.elm[b.index],a.key=b.index,a.parent=a.parent._,a.elmParent=a.elmParent.childNodes),y(b.vals,function(c,f,v){a.elmParent.length||(a.elmParent=a.elmParents.slice(-1)[0].childNodes),a.elmParent||(a.elmParent=a.elmParents.slice(-2)[0].childNodes),g="string"==typeof c?document.createTextNode(c):E(D(c),a.elmParent[0]&&a.elmParent[0].parentNode.tagName).firstChild,q=a.elmParent[a.key+f],b.elm=g,q?(q.parentNode.insertBefore(g,q),a.parent.splice(a.key+f,0,c)):a.elmParent[a.key+f]?a.elmParent[a.key+f]=g:(x=a.elmParents.slice(-1)[0],x[0]&&(x=x[x.length-1]),a.elm&&a.elm.length>=a.key&&(x=a.elm[0].parentNode),x instanceof NodeList&&(x=A(a.elmParents,function(a,b,c){return a.textContent!==a.fsdhjklghdklg}).pop()),x!==g&&(3!=x.nodeType?x.appendChild(g):(x.parentNode.insertBefore(g,x),x.parentNode.insertBefore(x,g))))}));break;case"rm":if(a.elmParent.childNodes&&(a.elmParent=a.elmParent.childNodes),0===a.elmParent.length&&(a.elmParent=a.elmParents.slice(-3)[0]),a.elmParent.childNodes&&(a.elmParent=a.elmParent.childNodes),a.parent._&&(a.parent=a.parent._),e=p.call(a.elmParent,b.index-b.num+1,b.index+1),0===b.index){h&&console.log("removing many from zero",p.call(a.parent),a.elmParent,"|||",a.parent[0],b.index,b.num),c=b.index;for(v=c+b.num;c<v;c++)a.elmParent[b.index].remove();b.elm=a.elmParent}else-1<b.index-b.num?1===b.num?(e=[a.elmParent[b.index]],h&&console.log("removing one",a.elmParent,e[0].outerHTML,b.index,p.call(a.elmParent).map(function(a){return a.outerHTML||a.nodeValue}),a.parent)):b.index+b.num<a.elmParent.length+1?(e=b.index,1<e&&"Z"===b.mode&&(e-=b.num-1),h&&console.log("removing many up",b.mode,a.elmParent,e,e+b.num),e=p.call(a.elmParent,e,e+b.num)):(h&&console.log("removing many down",p.call(a.elmParent),b.index-b.num,b.index),e=p.call(a.elmParent,b.index-b.num+1,b.index+1)):(h&&console.log("removing many negative",a.elmParent,b.index,b.index+b.num),e=p.call(a.elmParent,b.index,b.index+b.num)),e.length&&(b.elm=e[0].parentNode),h&&console.log("removing:",e,b,a.parent.slice(b.index-b.num+1,b.index+1)),y(e,function(a,b,c){a.parentNode.removeChild(a)})}l&&(b.runtime=performance.now()-k)}function G(b,d,l){var r=u.timing?performance.now():0;"string"==typeof b&&(b=document.querySelector(b));var k=b.outerHTML,h=k.slice(0,k.indexOf(">"))+">",m=k.slice(h.length,k.lastIndexOf("<")-1),p=h.match(/^<[\w\-]+/)[0].slice(1).toLowerCase();if(l&&l.trim()===m.trim())return{update:Boolean};m||(m=b.innerHTML=" "),d||(d=k);if(d instanceof Element||"string"==typeof d)d=F(d,p);l=u.timing?performance.now():0;var e={dest:b,vdom:d,debug:u.debug,timing:u.timing,initTime:l-r,update:function(b){var c=u.timing,f;return c&&(f=performance.now()),"string"==typeof b&&(b=F(h+b+"</"+p+">",p)),c&&(e.parseTime=performance.now()-f),e.vdom2=b,c&&(f=performance.now()),e.changes=J(e.vdom,b),c&&(e.diffTime=performance.now()-f,f=performance.now()),y(e.changes,I.bind(e)),c&&(e.applyTime=performance.now()-f),e.vdom=b,e}};return e}function u(b,d){return u._last=G(b,b,d),u._last.update(d)}Number.isNaN||(Number.isNaN=function(b){return"number"==typeof b&&isNaN(b)}),Array.isArray||(Array.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)});var J=function(b,d){function l(b,c,f,a,d,e,h){for(var g=a-e,k=d-h,m=Math.max(g,k),n=1;n<=m;n++){var l=c[a-n],r=f[d-n];if(n<=k&&n<=g&&b(l,r))return{a:a-n,b:d-n};for(var p=0;p<n;p++){var u=c[a-p],y=f[d-p];if(n<=k&&b(u,r))return{a:a-p,b:d-n};if(n<=g&&b(l,y))return{a:a-n,b:d-p}}}return{a:e-1,b:h-1}}function r(b,c){if(b===c)return!0;if(Array.isArray(b)){if(!Array.isArray(c))return!1;for(var f=b.length/15,a=Math.abs(b.length-c.length),d=0,e=b.length;d<e;d++)if(k(b[d],c[d])){if(2<=a&&a>f||a===b.length)return!1;a++}return!0}if("object"==typeof b){if("object"!=typeof c)return!1;var d=m(h(Object.keys(b)),h(Object.keys(c))),e=Object.keys(d).length,f=e/15,a=0,l;for(l in d)if(!k(b[l],c[l])){if(2<=a&&a>f||a+1===e)return!1;a++}return!0}return Number.isNaN(b)&&Number.isNaN(c)}function k(b,c){if(b===c)return!0;if(Array.isArray(b)){if(Array.isArray(c)&&b.length===c.length&&b[0]===c[0]&&String(b)===String(c)){for(var f=0,a=b.length;f<a;f++)if(!k(b[f],c[f]))return!1;return!0}return!1}if("object"==typeof b){if("object"!=typeof c)return!1;var d=Object.keys(b),f=Object.keys(c);if(d.length!==f.length||String(d)!==String(f))return!1;f=0;for(a=d.length;f<a;f++)if(!k(b[d[f]],c[d[f]]))return!1;return!0}return Number.isNaN(b)&&Number.isNaN(c)}function h(b){var c=0,d=b.length,a={};for(c;c<d;c++)a[b[c]]=!0;return a}function m(b,c){for(var d in c)b[d]=c[d];return b}var p=function(b,c,d,a){function e(a,b,c){a.push({type:"set",path:b,val:c})}function u(a,b,c,d,e){a.push({type:"rm",path:b,index:c,num:d,mode:e})}function x(a,b,c,d){a.push({type:"add",path:b,index:c,vals:d})}if(!(b===c||Number.isNaN(b)&&Number.isNaN(c)))if(Array.isArray(b)&&Array.isArray(c)){for(var g=b.length-1,q=c.length-1;0<=g&&0<=q;)if(k(b[g],c[q]))g--,q--;else{for(var t=l(k,b,c,g,q,0,0),n=g;n>t.a&&q>t.b;)if(r(b[n],c[q]))p(b[n],c[q],d,a.concat([n])),n--,q--;else{var g=l(r,b,c,n,q,t.a+1,t.b+1),n=n-g.a,y=q-g.b;1===n&&1===y?e(d,a.concat(g.a+1),c[g.b+1]):1===n&&2===y?(x(d,a,g.a+2,c.slice(g.b+2,q+1)),e(d,a.concat(g.a+1),c[g.b+1])):2===n&&1===y?(u(d,a,g.a+2,1,"I"),e(d,a.concat(g.a+1),c[g.b+1])):2===n&&2===y?(e(d,a.concat(g.a+2),c[g.b+2]),e(d,a.concat(g.a+1),c[g.b+1])):(0<n&&u(d,a,g.a+1,n,"X"),0<y&&x(d,a,g.a+1,c.slice(g.b+1,q+1))),n=g.a,q=g.b}n>t.a?u(d,a,n,n-t.a,"Z"):q>t.b&&x(d,a,n+1,c.slice(t.b+1,q+1)),g=t.a,q=t.b}0<=g?u(d,a,0,g+1):0<=q&&x(d,a,0,c.slice(0,q+1))}else if("object"==typeof b&&"object"==typeof c)for(q in t=m(h(Object.keys(b)),h(Object.keys(c))),t)p(b[q],c[q],d,a.concat([q]));else e(d,a,c)},e=[];return p(b,d,e,[]),e};C.temp=document.createElement("template");var E=function(b,d){var l=document.createElement(d||"div");return l.innerHTML=b,l};C.temp=document.createElement("template"),"content"in C.temp&&(E=C);var M={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1};return u.applyChanges=I,u.elementFromString=E,u.fromHTML=F,u.toHTML=D,u.odiff=J,u.parseHTML=H,u.updater=G,u.getRenderer=G,u.timing=!0,u.debug=!1,B.jQuery&&(B.jQuery.fn.intraHTML=function(b){return this.each(function(d,l){u(l,b)}),this}),u});
