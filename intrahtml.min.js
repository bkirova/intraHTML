// intraHTML: a better innerHTML (partial/non-destructive updates) for faster and simpler view rendering. (c)2015:dandavis, [CCBY4/MIT]  1.0.0 updated 15/11/12 
// usage: intraHTML(element, strNewInnerHTMLContent);
// includes a slightly modified copy of the odiff JS library by Billy Tetrud, under a modified MIT license per "Free to use for any purpose" from https://github.com/Tixit/odiff/blob/master/odiff.js
(function(){var jt="add",kt="childNodes",bn="div",xw="function",cj="object",kh="set",ux="string",gw="template",dc=performance,td=Array,oz=Number,pf=Object,zh=document,K="length",U="parentNode",W= kt,X="slice",Z="insertBefore",fp="index",gu="isArray",kg="concat",mh="createElement",lg="setAttribute",lj="isNaN",xu="push",kv="val",bv="now",vf="keys",yo="removeChild",yb="elm",fb="tagName",jj="parents",vw="splice",jr="filter",nz="innerHTML",xm="forEach",rj="call",kl="num";(function(x,u){ cj==typeof exports&&exports&& ux!=typeof exports.nodeName?module.exports=u(): xw==typeof define&&define.amd?define(["exports"],u()):x.intraHTML=u(x)})(this,function(x){function u(a){var d=u.temp;return d[nz]=a,d.content}function B(a,d){function e(a){var f=[],h=0,l,b,m=a[W][K];for(h;h<m;h++)if(l=a[W][h],l[fb]){b={$:l[fb].toLowerCase()};for(var c=0,p=l.attributes,d,v=p[K];c<v;c++)d=p[c],b[d.name]=d.value;b._=[],f[xu].apply(b._,e(l)),0===b._[K]&&delete b._,f[xu](b)}else f[xu](l.nodeValue);return f}return ux==typeof a?e(z(a,d))[0]:e({tagName:d|| bn,attributes:[],childNodes:[a]})[0]}function F(a,d){var e=[],k=/^_$/;return{node:a.reduce(function(a,d){return d=(""+d).replace(k, kt),e[xu](a),a&&a[d]},d),parents:e}}function G(a,d){var e=[];return{node:a.reduce(function(a,d){return e[xu](a),a&&a[d]},d),parents:e}}function A(a){var d="",e,k=A.hasOwnProperty,f=[];if(void 0===a)return"";for(var h in a)k[rj](a,h)&&"$"!==h&&"_"!==h&&(e=" "+h,""!==a[h]&&(e+="="+JSON.stringify(a[h])),d+=e);if(H[a.$])return"<"+a.$+d+" />";(e=a._||[],!td[gu](e))&&(e=[e]);for(var k=f[K]=0,l=e[K];k<l;k++)h=e[k]||"",f[k]= cj==typeof h?A(h):""+h;return"<"+a.$+d+">"+f.join("")+"</"+a.$+">"}function D(a,d,e){d=dc[bv]();var k=a.path[kg](a.index||a.key)[jr](function(b){return null!=b});e=k[jr](function(b){return null!=b})[X](-1)[0];var f=F(k,this.dest),h=G(k,this.vdom),l=e,b=f.node||f[jj][X](-1)[0],m=f[jj][jr](Boolean),c=f[jj][jr](Boolean)[X](-1)[0],p=h[jj][X](-1)[0],f=!(e-.1)&&"_"!=e&&"$"!=e; xw==typeof b&&(b=c);switch(a.type){case kh:if(!f&&( ux==typeof a.val||td[gu](a.val))){c[W]||(c=c[l]),b||(b=c),b[W]?(k=zh.createTextNode(a.val),b[U][Z](k,b),b[U][yo](b),a[yb]=k):(b.textContent=a.val,a[yb]=b),p[e]=a.val;break}if(f){if("$"==e&&String(k)==e)throw new TypeError("You cannot change the root element of an update-bound element: "+b.outerHTML);if("$"==e){k=zh[mh](a.val),b[U][Z](k,b);for(var w=b.attributes,f=0,h=w[K];f<h;f++){var v=w[f];k[lg](v.name,v.value)}w=b[W],f=0;for(h=w[K];f<h;f++)k.appendChild(w[0]);a[yb]=k,b[U][yo](b)}else!b[lg]&&c[lg]&&(b=c),b[lg](e,a.val),a[yb]=b;p[e]=a.val;break}k=z(A(a.val),p.$).firstChild,a[yb]=k,b[U][Z](k,b),b.remove(),p[e]=a.val;break;case jt:f||a.vals[xm](function(e,d){"_"==l&&(b=b[a.index],l=a.index,p=p._,c=c[W]),c[K]||(c=m[X](-1)[0][W]);var f= ux==typeof e?zh.createTextNode(e):z(A(e),c[0]&&c[0][U][fb]).firstChild,g=c[l+d];a[yb]=f,g?(g[U][Z](f,g),p[vw](l+d,0,e)):(c[l+d]?c[l+d]=f:(g=m[X](-1)[0],g[0]&&(g=g[g[K]-1]),b&&b[K]==l&&(g=b[0][U]),g!==f&&(3!=g.nodeType?g.appendChild(f):(g[U][Z](f,g),g[U][Z](g,f)))),p[vw](l+d+0,0,e))});break;case"rm":if(c[W]&&(c=c[W]),0===c[K]&&(c=m[X](-3)[0]),c[W]&&(c=c[W]),p._&&(p=p._),e=a.index-a[kl],k=a.index,f=[][X][rj](c,e+1,k+1),0===a.index){f=a.index;for(h=f+a[kl];f<h;f++)c[a.index]&&c[a.index].remove(),p[vw](a.index,1);a[yb]=c}else f=[][X][rj](c,a.index,a.index+a[kl]),f.map(function(b){b[U][yo](b)}),a[yb]=f[0][U],p[vw](e+1,k+1)}a.runtime=dc[bv]()-d}function C(a,d,e){var k=dc[bv](); ux==typeof a&&(a=zh.querySelector(a));var f=a[fb].toLowerCase(),h=a.outerHTML,l=h[X](0,h.indexOf(">"))+">",b=h[X](l[K],h.lastIndexOf("<")-1);if(e&&e.trim()===b.trim())return{update:Boolean};b||(b=a[nz]=" "),d||(d=h);if(d instanceof Element|| ux==typeof d)d=B(d,f);e=dc[bv]();var m={dest:a,vdom:d,initTime:e-k,update:function(b){var a=dc[bv]();if( ux==typeof b){var e=l+b+"</"+f+">";b=B(e,f),m.newHt=e}return m.parseTime=dc[bv]()-a,m.vdom2=b,a=dc[bv](),m.changes=I(m.vdom,b),m.diffTime=dc[bv]()-a,a=dc[bv](),m.changes[xm](D,m),m.applyTime=dc[bv]()-a,m}};return m}function r(a,d){return r._last=C(a,a,d),r._last.update(d)}oz[lj]||(oz[lj]=function(a){return"number"==typeof a&&isNaN(a)}),td[gu]||(td[gu]=function(a){return"[object td]"===pf.prototype.toString[rj](a)});var I=function(){function a(a,b,e,c,d,f,k){for(var n=c-f,h=d-k,t=Math.max(n,h),g=1;g<=t;g++){var r=b[c-g],E=e[d-g];if(g<=h&&g<=n&&a(r,E))return{a:c-g,b:d-g};for(var y=0;y<g;y++){var u=b[c-y],x=e[d-y];if(g<=h&&a(u,E))return{a:c-y,b:d-g};if(g<=n&&a(r,x))return{a:c-g,b:d-y}}}return{a:f-1,b:k-1}}function d(a,b){if(td[gu](a)){if(!td[gu](b))return!1;for(var d=a[K]/10,c=Math.abs(a[K]-b[K]),h=0;h<a[K];h++)if(e(a[h],b[h])){if(2<=c&&c>d||c===a[K])return!1;c++}return!0}if( cj==typeof a){if( cj!=typeof b)return!1;if(a===b)return!0;var h=f(k(pf[vf](a)),k(pf[vf](b))),w=pf[vf](h)[K],d=w/10,c=0,v;for(v in h)if(!e(a[v],b[v])){if(2<=c&&c>d||c+1===w)return!1;c++}return!0}return oz[lj](a)&&oz[lj](b)}function e(a,b){if(a===b)return!0;if(td[gu](a))return td[gu](b)&&a[K]===b[K]?!a.some(function(a,b,c){return!e(a,this[b])},b):!1;if( cj==typeof a){if( cj!=typeof b)return!1;var d=pf[vf](a),c=pf[vf](b);if(d[K]!==c[K])return!1;for(c=0;c<d[K];c++){var f=d[c];if(!e(a[f],b[f]))return!1}return!0}return oz[lj](a)&&oz[lj](b)}function k(a){var b={};return a[xm](function(a,b,d){this[a]=!0},b),b}function f(a,b){for(var d in b)a[d]=b[d];return a}var h=function(l,b,m,c){function p(a,b,c){a[xu]({type: kh,path:b,val:c})}function r(a,b,c,d){a[xu]({type:"rm",path:b,index:c,num:d})}function v(a,b,c,d){a[xu]({type: jt,path:b,index:c,vals:d})}if(!(l===b||oz[lj](l)&&oz[lj](b)))if(l instanceof td&&b instanceof td){for(var n=l[K]-1,q=b[K]-1;0<=n&&0<=q;)if(e(l[n],b[q]))n--,q--;else{for(var t=a(e,l,b,n,q,0,0),g=n;g>t.a&&q>t.b;)if(d(l[g],b[q]))h(l[g],b[q],m,c[kg]([g])),g--,q--;else{var n=a(d,l,b,g,q,t.a+1,t.b+1),g=g-n.a,u=q-n.b;1===g&&1===u?p(m,c[kg](n.a+1),b[n.b+1]):1===g&&2===u?(v(m,c,n.a+2,b[X](n.b+2,q+1)),p(m,c[kg](n.a+1),b[n.b+1])):2===g&&1===u?(r(m,c,n.a+2,1),p(m,c[kg](n.a+1),b[n.b+1])):2===g&&2===u?(p(m,c[kg](n.a+2),b[n.b+2]),p(m,c[kg](n.a+1),b[n.b+1])):(0<g&&r(m,c,n.a+1,g),0<u&&v(m,c,n.a+1,b[X](n.b+1,q+1))),g=n.a,q=n.b}g>t.a?r(m,c,g,g-t.a):q>t.b&&v(m,c,g+1,b[X](t.b+1,q+1)),n=t.a,q=t.b}0<=n?r(m,c,0,n+1):0<=q&&v(m,c,0,b[X](0,q+1))}else if(l instanceof pf&&b instanceof pf)for(t in q=f(k(pf[vf](l)),k(pf[vf](b))),q)q=c[kg]([t]),h(l[t],b[t],m,q);else p(m,c,b)};return function(a,b){var d=[];return h(a,b,d,[]),d}}();u.temp=zh[mh]( gw);var z=function(a,d){var e=zh[mh](d|| bn);return e[nz]=a,e};"content"in zh[mh]( gw)&&(z=u);var H={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1};return r.updater=C,r.applyChanges=D,r.toHTML=A,r.fromHTML=B,r.elementFromString=z,r.getRenderer=C,x.jQuery&&(x.jQuery.fn.intraHTML=function(a){return this.each(function(d,e){r(e,a)}),this}),r});}());
