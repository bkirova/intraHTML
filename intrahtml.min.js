// intraHTML: a better innerHTML (partial/non-destructive updates) for faster and simpler view rendering. (c)2015:dandavis, [CCBY4/MIT]
// usage: intraHTML(element, strNewInnerHTMLContent);
// includes a slightly modified copy of the odiff JS library by Billy Tetrud, under a modified MIT license per "Free to use for any purpose" from https://github.com/Tixit/odiff/blob/master/odiff.js
(function(A,z){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?module.exports=z():"function"==typeof define&&define.amd?define(["exports"],z()):A.intraHTML=z(A)})(this,function(A){function z(a,c,n){if(!(2>arguments.length))for(var k=a.length,m=0;m<k;m++)c(a[m],m,a)}function x(a,c){for(var n=a.length,k=[],m=0;m<n;m++)c(a[m],m,a)&&k.push(a[m]);return k}function B(a){var c=B.temp;return c.innerHTML=a,c.content}function E(a,c){function n(a){var c=[],p=0,d,e,q=a.childNodes.length;for(p;p<q;p++)if(d=a.childNodes[p],d.tagName){e={$:d.tagName.toLowerCase()};for(var f=0,g=d.attributes,l,t=g.length;f<t;f++)l=g[f],e[l.name]=l.value;e._=n(d),c.push(e)}else c.push(d.nodeValue);return c}return"string"==typeof a?H(a):n({tagName:c||"div",attributes:[],childNodes:[a]})[0]}function H(a){function c(b,a,f,g,l){return p[a]=f||"",""}var n={$:"ROOT",_:[]},k=n,m=/[\s>]/,p=n;a=a.split(/([<>])/);var d="",e,q,f=0,g=a.length;e=1;for(var l,t=[n],b=[/([\w\-]+)="([^"]*)"/g,/([\w\-]+)='([^']*)'/g,/([\w\-]+)=([^\s>\/]+)/g,/([\w\-]+)()/g];f<g;f++)if(q=a[f],e=q.slice(0,1),"<"===d)if("/"===e)n=p=t.pop(),d="";else{e=q.search(m),-1===e&&(e=20),d=q.slice(0,e),l=q.slice(e),t.push(n),n._.push(p={$:d,_:[]});if(l)for(e=0;4>e;e++)l=l.replace(b[e],c);I[d]?(d=q,n=p=t.pop()):(n=p,d=q)}else q&&"<"!==q&&">"!==q&&p._.push(-1===q.indexOf("&")?q:q.replace(/(&\w+;)/g,function(b,a){return F[a]||a})),d=q;return k._[0]}function L(a,c){var n=[],k=0,m=a.length,p=c,d;for(k;k<m&&(d=a[k],"_"===d&&(d="childNodes"),n.push(p),p=p[d],void 0!==p);k++);return{node:p,parents:n}}function M(a,c){var n=[],k=0,m=a.length,p=c;for(k;k<m&&(n.push(p),p=p[a[k]],void 0!==p);k++);return{node:p,parents:n}}function C(a){var c="",n=[],k,m,p,d;d=n.hasOwnProperty;if(void 0===a)return"";k=a.$;for(m in a)"$"!==m&&"_"!==m&&d.call(a,m)&&(c+=" "+m+(""===a[m]?"":"="+JSON.stringify(a[m])));if(I[k])return"<"+k+c+" />";(a=a._||[],!Array.isArray(a))&&(a=[a]),m=0,p;for(d=a.length;m<d;m++)p=a[m],n[m]="object"==typeof p?C(p):p;return"<"+k+c+">"+n.join("")+"</"+k+">"}function J(a,c,n,k){function m(b,a,f){return b.textContent!==b.fsdhjklghdklg}var p=(n=k.timing)?performance.now():0,d=k.debug,e=x(a.path.concat(a.index||a.key),function(b,a,f){return b!=a.xsdgdfg}),q=e.slice,f=x(e,function(b,a,f){return b!=a.xsdgdfg}).slice(-1)[0],g=L(e,k.dest),l=M(e,k.vdom),t=x(g.parents,Boolean),b={type:a.type,index:c,path:e,key:f,elm:g.node||g.parents.slice(-1)[0],elmParents:t,elmParent:t.slice(-1)[0],dest:k.dest,parents:l,parent:l.parents.slice(-1)[0],isAttrib:!(f-.1)&&"_"!=f&&"$"!=f,change:a},r,y,h,u,w;"function"==typeof b.elm&&(b.elm=b.elmParent),d&&console.info("CHANGE: "+c,b);switch(a.type){case"set":if(!b.isAttrib&&("string"==typeof a.val||Array.isArray(a.val))){b.elmParent.childNodes||(b.elmParent=b.elmParent[b.key]),b.elm||(b.elm=b.elmParent),q=a.val,Array.isArray(q)||(q=[q]),k=0;for(w=q.length;k<w;k++){c=q[k];if("string"==typeof c)if(b.elm instanceof NodeList&&(b.elm=x(b.elmParents,m).pop()),b.elm.childNodes){d&&console.log("set: non attrib, string, elm: ",b.key,[c],b.elm.outerHTML),h=document.createTextNode(c);if("_"===b.key)b.elm.textContent=c;else{if("$"===b.key){l=document.createElement(a.val),d&&console.warn("changing tag name!",a),b.elm.parentNode.insertBefore(l,b.elm),t=b.elm.attributes,g=0;for(e=t.length;g<e;g++)r=t[g],l.setAttribute(r.name,r.value);t=b.elm.childNodes,g=0;for(e=t.length;g<e;g++)l.appendChild(t[0])}else b.elm.parentNode.insertBefore(h,b.elm);b.elm.parentNode.removeChild(b.elm)}a.elm=h}else d&&console.log("set: non attrib, string, not elm",c),b.elm.textContent=c,a.elm=b.elm;else h="string"==typeof c?document.createTextNode(c):D(C(c),b.elmParent[0]&&b.elmParent[0].parentNode.tagName).firstChild,b.elm.parentNode||(b.elm=b.elmParent),(e=b.elm.childNodes[+f+k])?(d&&console.log("set: non attrib, not string, has old",c),b.elm.insertBefore(h,e),b.elm.removeChild(b.elm)):(d&&console.log("set: non attrib, not string, no old, appending",[c,h,h.outerHTML||h.textContent]),b.elm.appendChild(h));"_"==f&&(f=0,b.parent.length||(b.parent=b.parent._||(b.parent._=[]))),d&&console.info("attempting key change",+f+k,!!(1.1-f),f,k,c,b.parent[+f+k],[b.parent])}break}if(b.isAttrib){if("$"==f&&String(e)==f)throw new TypeError("You cannot change the root element of an update-bound element: "+b.elm.outerHTML);if("$"==f){l=document.createElement(a.val),d&&console.warn("changing tag name!",a),b.elm.parentNode.insertBefore(l,b.elm),t=b.elm.attributes,g=0;for(e=t.length;g<e;g++)r=t[g],l.setAttribute(r.name,r.value);t=b.elm.childNodes,g=0;for(e=t.length;g<e;g++)l.appendChild(t[0]);a.elm=l,b.elm.parentNode.removeChild(b.elm)}else!b.elm.setAttribute&&b.elm.parentNode&&b.elm.parentNode.setAttribute&&(b.elm=b.elm.parentNode),!b.elm.setAttribute&&(w=x(b.elmParents,function(b,a,f){return b.setAttribute}).slice(-1)[0]).setAttribute&&(b.elm=w),a.val===a.dgfjkdfl34534fd?b.elm.removeAttribute(f):b.elm.setAttribute(f,a.val),a.elm=b.elm;break}if(b.elm.length&&a.val===a.sdgfdf)for(d=0,f=b.elm.length;d<f;d++)b.elm[0].parentNode.removeChild(b.elm[0]);else b.elm instanceof NodeList&&(b.elm=x(b.elmParents,function(b,a,f){return b.textContent!==b.fsdhjklghdklg}).pop()),l=D(C(a.val),b.parent.$).firstChild,d&&console.log("element replacing",[b.elm.outerHTML||b.elm.textContent]," with ",[l.outerHTML]),a.elm=l,b.elm.parentNode.insertBefore(l,b.elm),b.elm.parentNode.removeChild(b.elm);break;case"add":b.isAttrib||("_"==b.key&&(b.elm=b.elm[a.index],b.key=a.index,b.parent=b.parent._,b.elmParent=b.elmParent.childNodes),z(a.vals,function(f,g,l){b.elmParent.length||(b.elmParent=b.elmParents.slice(-1)[0].childNodes),b.elmParent||(b.elmParent=b.elmParents.slice(-2)[0].childNodes),h="string"==typeof f?document.createTextNode(f):D(C(f),b.elmParent[0]&&b.elmParent[0].parentNode.tagName).firstChild,u=b.elmParent[b.key+g],a.elm=h,u?(u.parentNode.insertBefore(h,u),b.parent.splice(b.key+g,0,f)):b.elmParent[b.key+g]?b.elmParent[b.key+g]=h:(y=b.elmParents.slice(-1)[0],y[0]&&(y=y[y.length-1]),b.elm&&b.elm.length>=b.key&&(y=b.elm[0].parentNode),y instanceof NodeList&&(y=x(b.elmParents,function(b,a,f){return b.textContent!==b.fsdhjklghdklg}).pop()),y!==h&&(3!=y.nodeType?y.appendChild(h):(y.parentNode.insertBefore(h,y),y.parentNode.insertBefore(y,h))))}));break;case"rm":if(b.elmParent.childNodes&&(b.elmParent=b.elmParent.childNodes),0===b.elmParent.length&&(b.elmParent=b.elmParents.slice(-3)[0]),b.elmParent.childNodes&&(b.elmParent=b.elmParent.childNodes),b.parent._&&(b.parent=b.parent._),f=q.call(b.elmParent,a.index-a.num+1,a.index+1),0===a.index){d&&console.log("removing many from zero",q.call(b.parent),b.elmParent,"|||",b.parent[0],a.index,a.num),g=a.index;for(e=g+a.num;g<e;g++)b.elmParent[a.index].remove();a.elm=b.elmParent}else-1<a.index-a.num?1===a.num?(f=[b.elmParent[a.index]],d&&console.log("removing one",b.elmParent,f[0].outerHTML,a.index,q.call(b.elmParent).map(function(b){return b.outerHTML||b.nodeValue}),b.parent)):a.index+a.num<b.elmParent.length+1?(f=a.index,1<f&&"Z"===a.mode&&(f-=a.num-1),d&&console.log("removing many up",a.mode,b.elmParent,f,f+a.num),f=q.call(b.elmParent,f,f+a.num)):(d&&console.log("removing many down",q.call(b.elmParent),a.index-a.num,a.index),f=q.call(b.elmParent,a.index-a.num+1,a.index+1)):(d&&console.log("removing many negative",b.elmParent,a.index,a.index+a.num),f=q.call(b.elmParent,a.index,a.index+a.num)),f.length&&(a.elm=f[0].parentNode),d&&console.log("removing:",f,a,b.parent.slice(a.index-a.num+1,a.index+1)),z(f,function(b,a,f){b.parentNode.removeChild(b)})}n&&(a.runtime=performance.now()-p)}function G(a,c,n){"string"==typeof a&&(a=document.querySelector(a));var k=r.timing?performance.now():0,m=a.tagName.toLowerCase(),p="<"+m+">",d;a.childNodes.length||(a.innerHTML=" "),c||(c=a);if(c instanceof Element){c=c.innerHTML;if(n===c)return{update:Boolean};c=E(p+c+"</"+m+">",m)}return"string"==typeof c&&(c=E(c,m)),n=r.timing?performance.now():0,d={dest:a,vdom:c,debug:r.debug,timing:r.timing,initTime:n-k,update:function(a){var c=r.timing,f,g=0,l;c&&(f=performance.now()),"string"==typeof a&&(a=E(p+a+"</"+m+">",m)),c&&(d.parseTime=performance.now()-f),d.vdom2=a,c&&(f=performance.now()),d.changes=K(d.vdom,a),c&&(d.diffTime=performance.now()-f,f=performance.now());for(l=d.changes.length;g<l;g++)J(d.changes[g],g,d.changes,d);return c&&(d.applyTime=performance.now()-f),d.vdom=a,d}}}function r(a,c){return r._last=G(a,a,c),r._last.update(c)}Number.isNaN||(Number.isNaN=function(a){return"number"==typeof a&&isNaN(a)}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var K=function(a,c){function n(a,g,l,c,b,d,m){for(var h=c-d,k=b-m,n=Math.max(h,k),e=1;e<=n;e++){var p=g[c-e],q=l[b-e];if(e<=k&&e<=h&&a(p,q))return{a:c-e,b:b-e};for(var r=0;r<e;r++){var x=g[c-r],z=l[b-r];if(e<=k&&a(x,q))return{a:c-r,b:b-e};if(e<=h&&a(p,z))return{a:c-e,b:b-r}}}return{a:d-1,b:m-1}}function k(a,g){if(a===g)return!0;if(Array.isArray(a)){if(!Array.isArray(g))return!1;for(var c=a.length/15,e=Math.abs(a.length-g.length),b=0,k=a.length;b<k;b++)if(m(a[b],g[b])){if(2<=e&&e>c||e===a.length)return!1;e++}return!0}if("object"==typeof a){if("object"!=typeof g)return!1;var b=d(p(Object.keys(a)),p(Object.keys(g))),k=Object.keys(b).length,c=k/15,e=0,n;for(n in b)if(!m(a[n],g[n])){if(2<=e&&e>c||e+1===k)return!1;e++}return!0}return Number.isNaN(a)&&Number.isNaN(g)}function m(a,g){if(a===g)return!0;if(Array.isArray(a)){if(Array.isArray(g)&&a.length===g.length&&a[0]===g[0]&&String(a)===String(g)){for(var c=0,d=a.length;c<d;c++)if(!m(a[c],g[c]))return!1;return!0}return!1}if("object"==typeof a){if("object"!=typeof g)return!1;var b=Object.keys(a),c=Object.keys(g);if(b.length!==c.length||String(b)!==String(c))return!1;c=0;for(d=b.length;c<d;c++)if(!m(a[b[c]],g[b[c]]))return!1;return!0}return Number.isNaN(a)&&Number.isNaN(g)}function p(a){var c=0,d=a.length,e={};for(c;c<d;c++)e[a[c]]=!0;return e}function d(a,c){for(var d in c)a[d]=c[d];return a}var e=function(a,c,l,t){function b(a,b,c){a.push({type:"set",path:b,val:c})}function q(a,b,c,d,e){a.push({type:"rm",path:b,index:c,num:d,mode:e})}function r(a,b,c,d){a.push({type:"add",path:b,index:c,vals:d})}if(!(a===c||Number.isNaN(a)&&Number.isNaN(c)))if(Array.isArray(a)&&Array.isArray(c)){for(var h=a.length-1,u=c.length-1;0<=h&&0<=u;)if(m(a[h],c[u]))h--,u--;else{for(var w=n(m,a,c,h,u,0,0),v=h;v>w.a&&u>w.b;)if(k(a[v],c[u]))e(a[v],c[u],l,t.concat([v])),v--,u--;else{var h=n(k,a,c,v,u,w.a+1,w.b+1),v=v-h.a,x=u-h.b;1===v&&1===x?b(l,t.concat(h.a+1),c[h.b+1]):1===v&&2===x?(r(l,t,h.a+2,c.slice(h.b+2,u+1)),b(l,t.concat(h.a+1),c[h.b+1])):2===v&&1===x?(q(l,t,h.a+2,1,"I"),b(l,t.concat(h.a+1),c[h.b+1])):2===v&&2===x?(b(l,t.concat(h.a+2),c[h.b+2]),b(l,t.concat(h.a+1),c[h.b+1])):(0<v&&q(l,t,h.a+1,v,"X"),0<x&&r(l,t,h.a+1,c.slice(h.b+1,u+1))),v=h.a,u=h.b}v>w.a?q(l,t,v,v-w.a,"Z"):u>w.b&&r(l,t,v+1,c.slice(w.b+1,u+1)),h=w.a,u=w.b}0<=h?q(l,t,0,h+1):0<=u&&r(l,t,0,c.slice(0,u+1))}else if("object"==typeof a&&"object"==typeof c)for(u in w=d(p(Object.keys(a)),p(Object.keys(c))),w)e(a[u],c[u],l,t.concat([u]));else b(l,t,c)},q=[];return e(a,c,q,[]),q};B.temp=document.createElement("template");var D=function(a,c){var n=document.createElement(c||"div");return n.innerHTML=a,n};B.temp=document.createElement("template"),"content"in B.temp&&(D=B);var F={"&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">","&apos;":"'"};"nbsp iexcl cent pound curren yen brvbar sect uml copy ordf laquo not shy reg macr deg plusmn sup2 sup3 acute micro para middot cedil sup1 ordm raquo frac14 frac12 frac34 iquest Agrave Aacute Acirc Atilde Auml Aring AElig Ccedil Egrave Eacute Ecirc Euml Igrave Iacute Icirc Iuml ETH Ntilde Ograve Oacute Ocirc Otilde Ouml times Oslash Ugrave Uacute Ucirc Uuml Yacute THORN szlig agrave aacute acirc atilde auml aring aelig ccedil egrave eacute ecirc euml igrave iacute icirc iuml eth ntilde ograve oacute ocirc otilde ouml divide oslash ugrave uacute ucirc uuml yacute thorn yuml".split(" ").forEach(function(a,c,n){this["&"+a+";"]=String.fromCharCode(160+c)},F);var I={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1};return r.applyChanges=J,r.elementFromString=D,r.fromHTML=E,r.toHTML=C,r.odiff=K,r.parseHTML=H,r.updater=G,r.getRenderer=G,r.timing=!0,r.debug=!1,r.entities=F,A.jQuery&&(A.jQuery.fn.intraHTML=function(a){return this.each(function(c,n){r(n,a)}),this}),r});
