// intraHTML: a better innerHTML (partial/non-destructive updates) for faster and simpler view rendering. (c)2015:dandavis, [CCBY4/MIT]  1.0.0 updated 15/11/12 
// usage: intraHTML(element, strNewInnerHTMLContent);
// includes a slightly modified copy of the odiff JS library by Billy Tetrud, under a modified MIT license per "Free to use for any purpose" from https://github.com/Tixit/odiff/blob/master/odiff.js
(function(){(function(z,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?module.exports=t():"function"==typeof define&&define.amd?define(["exports"],t()):z.intraHTML=t(z)})(this,function(z){function t(b){var c=t.temp;return c.innerHTML=b,c.content}function B(b,c){function d(b){var c=[],e=0,f,a,g=b.childNodes.length;for(e;e<g;e++)if(f=b.childNodes[e],f.tagName){a={$:f.tagName.toLowerCase()};for(var q=0,v=f.attributes,C,w=v.length;q<w;q++)C=v[q],a[C.name]=C.value;a._=[],c.push.apply(a._,d(f)),0===a._.length&&delete a._,c.push(a)}else c.push(f.nodeValue);return c}return"string"==typeof b?d(u(b,c))[0]:d({tagName:c||"div",attributes:[],childNodes:[b]})[0]}function G(b,c){var d=[],h=/^_$/;return{node:b.reduce(function(b,c){return c=(""+c).replace(h,"childNodes"),d.push(b),b&&b[c]},c),parents:d}}function H(b,c){var d=[];return{node:b.reduce(function(b,c){return d.push(b),b&&b[c]},c),parents:d}}function x(b){var c="",d,h=x.hasOwnProperty,m=[];if(void 0===b)return"";for(var e in b)h.call(b,e)&&"$"!==e&&"_"!==e&&(d=" "+e,""!==b[e]&&(d+="="+JSON.stringify(b[e])),c+=d);if(I[b.$])return"<"+b.$+c+" />";(d=b._||[],!Array.isArray(d))&&(d=[d]);for(var h=m.length=0,f=d.length;h<f;h++)e=d[h]||"",m[h]="object"==typeof e?x(e):""+e;return"<"+b.$+c+">"+m.join("")+"</"+b.$+">"}function D(b,c,d){d=performance.now();var h=b.path.concat(b.index||b.key).filter(function(a){return null!=a}),m=h.filter(function(a){return null!=a}).slice(-1)[0],e=G(h,this.dest),f=H(h,this.vdom),a={type:b.type,index:c,path:h,key:m,elm:e.node||e.parents.slice(-1)[0],elmParents:e.parents.filter(Boolean),elmParent:e.parents.filter(Boolean).slice(-1)[0],dest:this.dest,parents:f,parent:f.parents.slice(-1)[0],velm:f.node,vdom:this.vdom,isElm:"string"!=typeof f.node,isAttrib:!(m-.1)&&"_"!=m&&"$"!=m,change:b};"function"==typeof a.elm&&(a.elm=a.elmParent),(f=this.debug)&&console.info("CHANGE",a,e);switch(b.type){case"set":if(!a.isAttrib&&("string"==typeof b.val||Array.isArray(b.val))){a.elmParent.childNodes||(a.elmParent=a.elmParent[a.key]),a.elm||(a.elm=a.elmParent),c=b.val,Array.isArray(c)||(c=[c]),c.forEach(function(f,c){if("string"==typeof f)if(a.elm instanceof NodeList&&(a.elm=a.elmParent),a.elm.childNodes){var g=document.createTextNode(f);a.elm.parentNode.insertBefore(g,a.elm),a.elm.parentNode.removeChild(a.elm),b.elm=g}else a.elm.textContent=f,b.elm=a.elm;else{g="string"==typeof f?document.createTextNode(f):u(x(f),a.elmParent[0]&&a.elmParent[0].parentNode.tagName).firstChild,a.elm.parentNode||(a.elm=a.elmParent);var d=a.elm.childNodes[+m+c];d?(a.elm.insertBefore(g,d),a.elm.removeChild(a.elm)):a.elm.appendChild(g)}a.parent[+m+c]=f});break}if(a.isAttrib){if("$"==m&&String(h)==m)throw new TypeError("You cannot change the root element of an update-bound element: "+a.elm.outerHTML);if("$"==m){c=document.createElement(b.val),a.elm.parentNode.insertBefore(c,a.elm),e=a.elm.attributes,f=0;for(h=e.length;f<h;f++){var g=e[f];c.setAttribute(g.name,g.value)}e=a.elm.childNodes,f=0;for(h=e.length;f<h;f++)c.appendChild(e[0]);b.elm=c,a.elm.parentNode.removeChild(a.elm)}else!a.elm.setAttribute&&a.elmParent.setAttribute&&(a.elm=a.elmParent),a.elm.setAttribute(m,b.val),b.elm=a.elm;a.parent[m]=b.val;break}a.elm.length&&b.val===b.sdgfdf?([].slice.call(a.elm).forEach(function(a){a.parentNode.removeChild(a)}),delete a.parent[m]):(c=u(x(b.val),a.parent.$).firstChild,f&&console.log("element replacing",[a.elm.outerHTML||a.elm.textContent]," with ",[c.outerHTML]),b.elm=c,a.elm.parentNode.insertBefore(c,a.elm),a.elm.parentNode.removeChild(a.elm),a.parent[m]=b.val);break;case"add":a.isAttrib||("_"==a.key&&(a.elm=a.elm[b.index],a.key=b.index,a.parent=a.parent._,a.elmParent=a.elmParent.childNodes),b.vals.forEach(function(f,c){a.elmParent.length||(a.elmParent=a.elmParents.slice(-1)[0].childNodes);var g="string"==typeof f?document.createTextNode(f):u(x(f),a.elmParent[0]&&a.elmParent[0].parentNode.tagName).firstChild,d=a.elmParent[a.key+c];b.elm=g,d?(d.parentNode.insertBefore(g,d),a.parent.splice(a.key+c,0,f)):(a.elmParent[a.key+c]?a.elmParent[a.key+c]=g:(d=a.elmParents.slice(-1)[0],d[0]&&(d=d[d.length-1]),a.elm&&a.elm.length>=a.key&&(d=a.elm[0].parentNode),d!==g&&(3!=d.nodeType?d.appendChild(g):(d.parentNode.insertBefore(g,d),d.parentNode.insertBefore(d,g)))),a.parent.splice(a.key+c+0,0,f))}));break;case"rm":if(a.elmParent.childNodes&&(a.elmParent=a.elmParent.childNodes),0===a.elmParent.length&&(a.elmParent=a.elmParents.slice(-3)[0]),a.elmParent.childNodes&&(a.elmParent=a.elmParent.childNodes),a.parent._&&(a.parent=a.parent._),c=[].slice.call(a.elmParent,b.index-b.num+1,b.index+1),0===b.index){f=b.index;for(h=f+b.num;f<h;f++)a.elmParent[b.index]&&a.elmParent[b.index].remove(),a.parent.splice(b.index,1);b.elm=a.elmParent}else-1<b.index-b.num?1===b.num?(c=[a.elmParent[b.index]],h=function(){a.parent.splice(b.index-b.num+1,b.num)}):b.index+b.num<a.elmParent.length+1?(f&&console.log("removing many up",a.elmParent,b.index,b.index+b.num),c=[].slice.call(a.elmParent,b.index,b.index+b.num),h=function(){a.parent.splice(b.index,b.num)}):(f&&console.log("removing many down",[].slice.call(a.elmParent),b.index-b.num,b.index),c=[].slice.call(a.elmParent,b.index-b.num+1,b.index+1),h=function(){a.parent.splice(b.index-b.num+1,b.num)}):(c=[].slice.call(a.elmParent,b.index,b.index+b.num),h=function(){a.parent.splice(b.index,b.num)}),c.length&&(b.elm=c[0].parentNode),f&&console.log("removing:",c,b,a.parent.slice(b.index-b.num+1,b.index+1),[].slice.call(b.elm.childNodes)),c.map(function(a){a.parentNode.removeChild(a)}),h()}b.runtime=performance.now()-d}function A(b,c,d){var h=performance.now();"string"==typeof b&&(b=document.querySelector(b));var m=b.tagName.toLowerCase(),e=b.outerHTML,f=e.slice(0,e.indexOf(">"))+">",a=e.slice(f.length,e.lastIndexOf("<")-1);if(d&&d.trim()===a.trim())return{update:Boolean};a||(a=b.innerHTML=" "),c||(c=e);if(c instanceof Element||"string"==typeof c)c=B(c,m);d=performance.now();var g={dest:b,vdom:c,debug:p.debug,initTime:d-h,update:function(a){var b=performance.now();return"string"==typeof a&&(a=B(f+a+"</"+m+">",m)),g.parseTime=performance.now()-b,g.vdom2=a,b=performance.now(),g.changes=E(g.vdom,a),g.diffTime=performance.now()-b,b=performance.now(),g.changes.forEach(D,g),g.applyTime=performance.now()-b,g}};return A.last=g}function p(b,c){return p._last=A(b,b,c),p._last.update(c)}Number.isNaN||(Number.isNaN=function(b){return"number"==typeof b&&isNaN(b)}),Array.isArray||(Array.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)});var E=function(){function b(b,a,c,d,e,h,m){for(var k=d-h,n=e-m,r=Math.max(k,n),l=1;l<=r;l++){var p=a[d-l],F=c[e-l];if(l<=n&&l<=k&&b(p,F))return{a:d-l,b:e-l};for(var y=0;y<l;y++){var t=a[d-y],u=c[e-y];if(l<=n&&b(t,F))return{a:d-y,b:e-l};if(l<=k&&b(p,u))return{a:d-l,b:e-y}}}return{a:h-1,b:m-1}}function c(b,a){if(Array.isArray(b)){if(!Array.isArray(a))return!1;for(var c=b.length/10,e=Math.abs(b.length-a.length),v=0;v<b.length;v++)if(d(b[v],a[v])){if(2<=e&&e>c||e===b.length)return!1;e++}return!0}if("object"==typeof b){if("object"!=typeof a)return!1;if(b===a)return!0;var v=m(h(Object.keys(b)),h(Object.keys(a))),p=Object.keys(v).length,c=p/10,e=0,w;for(w in v)if(!d(b[w],a[w])){if(2<=e&&e>c||e+1===p)return!1;e++}return!0}return Number.isNaN(b)&&Number.isNaN(a)}function d(b,a){if(b===a)return!0;if(Array.isArray(b))return Array.isArray(a)&&b.length===a.length?!b.some(function(a,b,c){return!d(a,this[b])},a):!1;if("object"==typeof b){if("object"!=typeof a)return!1;var c=Object.keys(b),e=Object.keys(a);if(c.length!==e.length)return!1;for(e=0;e<c.length;e++){var h=c[e];if(!d(b[h],a[h]))return!1}return!0}return Number.isNaN(b)&&Number.isNaN(a)}function h(b){var a={};return b.forEach(function(a,b,c){this[a]=!0},a),a}function m(b,a){for(var c in a)b[c]=a[c];return b}var e=function(f,a,g,q){function p(a,b,c){a.push({type:"set",path:b,val:c})}function t(a,b,c,d){a.push({type:"rm",path:b,index:c,num:d})}function w(a,b,c,d){a.push({type:"add",path:b,index:c,vals:d})}if(!(f===a||Number.isNaN(f)&&Number.isNaN(a)))if(f instanceof Array&&a instanceof Array){for(var k=f.length-1,n=a.length-1;0<=k&&0<=n;)if(d(f[k],a[n]))k--,n--;else{for(var r=b(d,f,a,k,n,0,0),l=k;l>r.a&&n>r.b;)if(c(f[l],a[n]))e(f[l],a[n],g,q.concat([l])),l--,n--;else{var k=b(c,f,a,l,n,r.a+1,r.b+1),l=l-k.a,u=n-k.b;1===l&&1===u?p(g,q.concat(k.a+1),a[k.b+1]):1===l&&2===u?(w(g,q,k.a+2,a.slice(k.b+2,n+1)),p(g,q.concat(k.a+1),a[k.b+1])):2===l&&1===u?(t(g,q,k.a+2,1),p(g,q.concat(k.a+1),a[k.b+1])):2===l&&2===u?(p(g,q.concat(k.a+2),a[k.b+2]),p(g,q.concat(k.a+1),a[k.b+1])):(0<l&&t(g,q,k.a+1,l),0<u&&w(g,q,k.a+1,a.slice(k.b+1,n+1))),l=k.a,n=k.b}l>r.a?t(g,q,l,l-r.a):n>r.b&&w(g,q,l+1,a.slice(r.b+1,n+1)),k=r.a,n=r.b}0<=k?t(g,q,0,k+1):0<=n&&w(g,q,0,a.slice(0,n+1))}else if(f instanceof Object&&a instanceof Object)for(r in n=m(h(Object.keys(f)),h(Object.keys(a))),n)n=q.concat([r]),e(f[r],a[r],g,n);else p(g,q,a)};return function(b,a){var c=[];return e(b,a,c,[]),c}}();t.temp=document.createElement("template");var u=function(b,c){var d=document.createElement(c||"div");return d.innerHTML=b,d};"content"in document.createElement("template")&&(u=t);var I={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1};return p.odiff=E,p.updater=A,p.applyChanges=D,p.toHTML=x,p.fromHTML=B,p.elementFromString=u,p.getRenderer=A,z.jQuery&&(z.jQuery.fn.intraHTML=function(b){return this.each(function(c,d){p(d,b)}),this}),p})})();
